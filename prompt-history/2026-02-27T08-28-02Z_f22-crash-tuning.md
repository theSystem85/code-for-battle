# Prompt History
- UTC: 2026-02-27T08:28:02Z
- LLM: GPT-5.2-Codex

## Prompt
The user was unsatisfied with the code that the agent previously produced, which can be found as the latest commit in the git history.

<PREVIOUS_PR_TITLE>
Preserve F22 crash momentum and add burning-smoke visuals; exempt crash state from movement resets; add E2E test
</PREVIOUS_PR_TITLE>

<PREVIOUS_PR_DESCRIPTION>
### Motivation
- Fix a regression where an airborne F22 dropped vertically on destruction instead of preserving forward momentum during the crash glide. 
- Improve crash visuals by adding a visible burning/glow component to smoke particles emitted during descent. 
- Ensure generic movement logic does not overwrite F22 crash glide velocity so the unit continues its heading until impact. 

### Description
- Capture current velocity in `beginF22CrashSequence` (`f22CrashInitialSpeed`) and compute an interpolated `crashSpeed` in `updateF22CrashState`, applying it to `movement.targetVelocity` and rotation so the F22 glides forward while descending (`src/game/movementF22.js`).
- Extend `emitSmokeParticles` to accept an options object with `fireIntensity` and persist `fireIntensity` on particles so crash smoke can visually burn (`src/utils/smokeUtils.js`).
- Render a flame/glow overlay for smoke particles carrying `fireIntensity` in the smoke/effects renderer (`src/rendering/effectsRenderer.js`).
- Prevent the core movement system from zeroing air-unit velocity for crash-controlled F22 by adding `isF22CrashControlled` checks and skipping path/velocity reset logic during `f22State === 'crashing'` (`src/game/movementCore.js`).
- Add an automated Playwright E2E test `tests/e2e/f22CrashMomentum.test.js` and update tracking/docs (`TODO/Bugs.md`, `specs/021-f22-raptor-unit.md`, `specs/027-playwright-e2e-testing.md`, and prompt-history files).

### Testing
- Ran repository lint flow with `npm run lint:fix:changed` which completed successfully. 
- Ran targeted ESLint on modified files with `npx eslint` and received no errors. 
- Attempted to run the new Playwright E2E (`npm run test:e2e -- tests/e2e/f22CrashMomentum.test.js --project=chromium`) but the environment lacks Playwright Chromium and `npx playwright install chromium` failed (CDN `403`), so the E2E test was not executed.
</PREVIOUS_PR_DESCRIPTION>

<PREVIOUS_PR_DIFF_AND_COMMENTS>
diff --git a/TODO/Bugs.md b/TODO/Bugs.md
(File changed with 2 additions, 0 deletions)
diff --git a/TODO/Bugs.md b/TODO/Bugs.md
(File changed with 1 additions, 0 deletions)
diff --git a/None b/prompt-history/2026-02-26T20-56-52Z_f22-crash-fire.md
(File changed with 6 additions, 0 deletions)
diff --git a/None b/prompt-history/2026-02-26T21-09-42Z_f22-crash-fix.md
(File changed with 52 additions, 0 deletions)
diff --git a/specs/021-f22-raptor-unit.md b/specs/021-f22-raptor-unit.md
(File changed with 2 additions, 0 deletions)
diff --git a/specs/027-playwright-e2e-testing.md b/specs/027-playwright-e2e-testing.md
(File changed with 22 additions, 0 deletions)
diff --git a/src/game/movementCore.js b/src/game/movementCore.js
(File changed with 1 additions, 0 deletions)
diff --git a/src/game/movementCore.js b/src/game/movementCore.js
(File changed with 3 additions, 2 deletions)
diff --git a/src/game/movementF22.js b/src/game/movementF22.js
(File changed with 14 additions, 3 deletions)
diff --git a/src/rendering/effectsRenderer.js b/src/rendering/effectsRenderer.js
(File changed with 21 additions, 0 deletions)
diff --git a/src/utils/smokeUtils.js b/src/utils/smokeUtils.js
(File changed with 13 additions, 1 deletions)
diff --git a/None b/tests/e2e/f22CrashMomentum.test.js
(File changed with 149 additions, 0 deletions)
</PREVIOUS_PR_DIFF_AND_COMMENTS>

Please address any inline comments on the diff, as well as any additional instructions below.

Two more things to adjust:
1) ensure the jet while crashing is capped at half max speed
2) ensure the wreck is heading into the same direction as the f22 when crashing
