# 2025-02-25T18:00:00Z
## LLM: Copilot (Claude Opus 4.6)

## Prompt
Try to fix as many open or incorrectly implemented issues from 021-f22-raptor-unit.md spec file as you can in one response! Also review the current affected code and improve where you see potential! When done make an update to the status of the specs in that file based on what you worked on!

## Summary
Addressed all ❌ and ? items in spec 021. Key fixes:

### Critical bug fix (A7, A9, A10, A11)
- **Root cause**: `movementCore.js` zeroed F22 velocity during liftoff because `flightState='takeoff'` triggered the airborne flight-plan handler but no flight plan existed yet
- **Fix**: Added `isF22RunwayControlled` guard to prevent velocity zeroing during takeoff_roll, liftoff, and landing_roll states

### Takeoff speed (A7, A10)
- Raised `F22_GROUND_TAKEOFF_SPEED_MIN` from 0.9 to 1.5
- Raised `F22_GROUND_TAKEOFF_SPEED_MAX` from 1.7 to 2.2
- Changed easing from `easeInQuad` (slow start) to `easeOutQuad` (fast start)

### Landing/parking (A8)
- Landing roll → taxi_to_parking now dynamically claims parking slot via `claimAirstripParkingSlot`
- Handles missing/occupied slots gracefully
- taxi_to_parking state also re-claims slot if needed

### Post-takeoff destination (A11)
- Added fallback destination derivation from active target
- Added forward-flight fallback from runway exit if no destination exists

### Collision (B1, B2, B3)
- F22 now completely skips unit collision in `checkUnitCollision` (both ground and air states)
- Removed unreachable F22 collision response in `applyUnitCollisionResponse`
- Air avoidance already correctly skipped for F22

### Combat orbit (B4)
- Increased combat wave amplitude from 2.2 to 3.5 tiles
- Added secondary wave oscillation for more dynamic/wave-like orbit shape

### Code cleanup
- Removed dead `f22State = 'approach_runway'` assignment in RTB flow (immediately overwritten by 'wait_landing_clearance')

### Verified already working in code
- A4: Runway serialization via single `f22RunwayOperation` slot
- A5: Wait state sets velocity=0
- A6: `isRunwayStartClear()` checks for other F22s
- C2: Volley continues via `volleyState` persistence
- C3: `UNIT_AMMO_CAPACITY.f22Raptor = 8`
- C4: Save/load hydration clamps ammo to 8

### Files modified
- `src/game/movementF22.js`
- `src/game/movementCore.js`
- `src/game/movementCollision.js`
- `specs/021-f22-raptor-unit.md`
- `TODO/Features.md`
